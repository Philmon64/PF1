<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INSY √úbung ‚Äì Bildfragen Quiz</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .progress-container { background: #f0f0f0; padding: 20px 30px; border-bottom: 2px solid #e0e0e0; }
        .progress-bar { width: 100%; height: 30px; background: #e0e0e0; border-radius: 15px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 0.3s ease; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .stats { display: flex; justify-content: space-around; margin-top: 15px; flex-wrap: wrap; gap: 10px; }
        .stat { background: white; padding: 10px 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .stat-label { font-size: 0.85em; color: #666; margin-bottom: 5px; }
        .stat-value { font-size: 1.5em; font-weight: bold; color: #667eea; }
        .quiz-content { padding: 30px; }
        .category-selector { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
        .category-btn { padding: 12px 24px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 25px; cursor: pointer; font-size: 1em; transition: all 0.3s ease; font-weight: 600; }
        .category-btn:hover { background: #667eea; color: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3); }
        .category-btn.active { background: #667eea; color: white; }
        .question-card { background: #f8f9fa; border-radius: 15px; padding: 30px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .question-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .question-number { background: #667eea; color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold; }
        .category-tag { background: #764ba2; color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.85em; }
        .question-text { font-size: 1.2em; color: #333; margin-bottom: 25px; line-height: 1.6; }
        .options { display: flex; flex-direction: column; gap: 12px; }
        .option { background: white; border: 2px solid #e0e0e0; border-radius: 12px; padding: 15px 20px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 15px; position: relative; }
        .option:hover { border-color: #667eea; transform: translateX(5px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2); }
        .option-letter { background: #667eea; color: white; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
        .option.selected { border-color: #667eea; background: #f0f4ff; }
        .option.correct { border-color: #28a745; background: #d4edda; }
        .option.correct .option-letter { background: #28a745; }
        .option.wrong { border-color: #dc3545; background: #f8d7da; }
        .option.wrong .option-letter { background: #dc3545; }
        .option-checkbox { position: absolute; right: 20px; width: 25px; height: 25px; }
        .fill-in-the-blank-container { display: flex; flex-direction: column; gap: 15px; }
        .fill-in-the-blank-input { width: 100%; padding: 10px; border: 2px solid #ccc; border-radius: 8px; font-size: 1.1em; transition: border-color 0.3s; }
        .fill-in-the-blank-input:focus { border-color: #667eea; outline: none; }
        .fill-in-the-blank-wrapper { display: flex; align-items: center; gap: 10px; }
        .fill-in-the-blank-label { font-weight: bold; color: #333; min-width: 160px; }
        .answer-section { margin-top: 20px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid #667eea; }
        .answer-section.show { display: block; }
        .answer-section.hide { display: none; }
        .answer-header { font-weight: bold; color: #667eea; margin-bottom: 10px; font-size: 1.1em; }
        .answer-text { color: #333; line-height: 1.6; }
        .button-group { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; }
        .btn { padding: 12px 30px; border: none; border-radius: 25px; cursor: pointer; font-size: 1em; font-weight: 600; transition: all 0.3s ease; flex: 1; min-width: 150px; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #545b62; transform: translateY(-2px); }
        .btn-success { background: #28a745; color: white; }
        .btn-success:hover { background: #218838; transform: translateY(-2px); }
        .result-summary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 15px; text-align: center; margin-top: 30px; }
        .result-summary h2 { font-size: 2.5em; margin-bottom: 20px; }
        .result-score { font-size: 4em; font-weight: bold; margin: 20px 0; }
        .result-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-top: 30px; }
        .result-detail { background: rgba(255,255,255,0.2); padding: 20px; border-radius: 12px; }
        .result-detail-value { font-size: 2em; font-weight: bold; margin-top: 10px; }
        .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #666; border-top: 2px solid #e0e0e0; }
        @media (max-width: 768px) {
            .header h1 { font-size: 1.5em; }
            .question-text { font-size: 1.1em; }
            .btn { min-width: 100%; }
            .result-score { font-size: 3em; }
        }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px);} to { opacity: 1; transform: translateY(0);} }
        .fill-in-the-blank-input.correct-answer { border-color: #28a745; background-color: #d4edda; }
        .fill-in-the-blank-input.wrong-answer { border-color: #dc3545; background-color: #f8d7da; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì INSY ‚Äì Quiz aus deinen Bildern</h1>
            <p>Informationssysteme, OS-Grundlagen, SSH, Boot/systemd, Dateirechte</p>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0%</div>
            </div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Fortschritt</div>
                    <div class="stat-value" id="progressText">0/0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Richtig</div>
                    <div class="stat-value" id="correctCount" style="color: #28a745;">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Falsch</div>
                    <div class="stat-value" id="wrongCount" style="color: #dc3545;">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Erfolgsrate</div>
                    <div class="stat-value" id="successRate">0%</div>
                </div>
            </div>
        </div>

        <div class="quiz-content">
            <div class="category-selector" id="categorySelector"></div>
            <div id="quizContainer"></div>

            <div class="button-group">
                <button class="btn btn-secondary" id="prevBtn" style="display: none;">‚¨ÖÔ∏è Vorherige Frage</button>
                <button class="btn btn-primary" id="nextBtn">N√§chste Frage ‚û°Ô∏è</button>
                <button class="btn btn-success" id="finishBtn" style="display: none;">‚úÖ Quiz Beenden</button>
                <button class="btn btn-primary" id="checkAnswerBtn">Antwort √úberpr√ºfen ‚úîÔ∏è</button>
            </div>
        </div>

        <div class="footer">
            <p>üí° MC = Mehrfachauswahl m√∂glich. R/F = Richtig/Falsch. FTB = L√ºckentext.</p>
            <p style="margin-top: 10px;">FHNW ‚Äì INSY 2025</p>
        </div>
    </div>

    <script>
        // Fragen aus den hochgeladenen Bildern
        const questionsData = [
            // 1) Informationssystem (Bild 1)
            { type: 'SC', id: 1, category: 'info', categoryName: 'Informationssysteme', question: 'Welche Aussage beschreibt am besten ein computergest√ºtztes Informationssystem?', options: [
                'Ein Informationssystem ist ein sozio-technisches System, das die Erfassung, Speicherung, √úbertragung und/oder Transformation von Informationen durch Informationstechnik teilweise automatisiert.',
                'Ein Informationssystem ist ein organisatorisches System, das Informationen ausschlie√ülich manuell verarbeitet.',
                'Ein Informationssystem besteht ausschlie√ülich aus Hardware und Software zur Datenverarbeitung.',
                'Ein Informationssystem ist ein technisches System, das ausschlie√ülich f√ºr die automatische Datenspeicherung verwendet wird.'
            ], correct: 0, explanation: 'Aus der Vorlesung: sozio-technisches System mit teilweise automatisierter Verarbeitung durch IT.' },

            // 2) SSH first-connection Warnung (Bild 2)
            { type: 'MC', id: 2, category: 'ssh', categoryName: 'SSH & Sicherheit', question: 'SSH-Meldung ‚ÄûThe authenticity of host ... can‚Äôt be established.‚Äú ‚Äì welche Aussagen sind WAHR?', options: [
                'Hinweis, dass man sich von diesem Rechner noch nie mit diesem Server verbunden hat.',
                'Bei ‚Äûyes‚Äú wird der Host-Key dauerhaft als vertrauensw√ºrdig gespeichert (future Verbindungen fragen nicht mehr).',
                'Die Warnung erscheint, weil der SSH-Server ein schwaches Passwort hat.',
                'Dauerhafte Speicherung der Host-Keys erfolgt in ~/.ssh/known_hosts.',
                'Die Meldung bedeutet, der Client hat den Server bereits als vertrauensw√ºrdig gespeichert.'
            ], correct: [0,1,3], explanation: 'Unbekannter Host-Key. Speicherung in ~/.ssh/known_hosts. Passwort-St√§rke ist hier irrelevant.' },

            // 3‚Äì11) OS Wahr/Falsch (Bild 3)
            { type: 'RF', id: 3, category: 'os', categoryName: 'OS-Grundlagen', question: '(R/F) Der Betriebssystem-Kernel ben√∂tigt besonderen Schutz.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Kernel l√§uft mit h√∂chsten Rechten.' },
            { type: 'RF', id: 4, category: 'os', categoryName: 'OS-Grundlagen', question: '(R/F) Die Version/Art des Betriebssystems hat keinen Einfluss auf die darauf laufende Software.', options: ['Richtig', 'Falsch'], correct: 1, explanation: 'Doch, ABI/API, Bibliotheken etc. √§ndern sich.' },
            { type: 'RF', id: 5, category: 'os', categoryName: 'OS-Grundlagen', question: '(R/F) Benutzer, Rollen und Rechte werden durch das Betriebssystem geregelt.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Kernaufgabe des OS.' },
            { type: 'RF', id: 6, category: 'os', categoryName: 'OS-Grundlagen', question: '(R/F) Linux ist ein vollst√§ndiges Betriebssystem.', options: ['Richtig', 'Falsch'], correct: 1, explanation: 'Linux = Kernel; ein komplettes OS ist z. B. GNU/Linux.' },
            { type: 'RF', id: 7, category: 'os', categoryName: 'OS-Grundlagen', question: '(R/F) Programme m√ºssen speziell f√ºr die Hardware des Computers entwickelt werden.', options: ['Richtig', 'Falsch'], correct: 1, explanation: 'Nicht speziell f√ºr jede Hardware; Portierung/Architektur ja, aber nicht pro Ger√§t.' },
            { type: 'RF', id: 8, category: 'os', categoryName: 'OS-Grundlagen', question: '(R/F) Ein Hypervisor wird im Virtualisierungskontext auch als ‚ÄûGast‚Äú bezeichnet.', options: ['Richtig', 'Falsch'], correct: 1, explanation: 'Der Hypervisor ist ‚ÄûHost‚Äú. ‚ÄûGuest‚Äú sind die VMs.' },
            { type: 'RF', id: 9, category: 'os', categoryName: 'OS-Grundlagen', question: '(R/F) Ein Betriebssystem verwaltet die Ressourcen eines Computers.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'CPU, RAM, Ger√§te, Prozesse etc.' },
            { type: 'RF', id: 10, category: 'os', categoryName: 'OS-Grundlagen', question: '(R/F) Der Kernel bringt eine Shell mit.', options: ['Richtig', 'Falsch'], correct: 1, explanation: 'Shell ist Userspace-Programm.' },
            { type: 'RF', id: 11, category: 'os', categoryName: 'OS-Grundlagen', question: '(R/F) Linux ist Open Source.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Ja, GPL.' },

            // 12) Schalenmodell (Bild 4)
            { type: 'FTB', id: 12, category: 'os', categoryName: 'OS-Grundlagen', question: 'Schalenmodell (au√üen ‚Üí Mitte ‚Üí innen): Trage die drei Schichten ein.', correct: [
                ['Anwendungsprogramme','Anwendungen','User-Programme'],
                ['Kernel'],
                ['Hardware']
            ], placeholder: ['Au√üen', 'Mitte', 'Innen'], explanation: 'Au√üen: Anwendungsprogramme, Mitte: Kernel, Innen: Hardware.' },

            // 13) Boot-Prozess Reihenfolge (Bild 5)
            { type: 'FTB', id: 13, category: 'boot', categoryName: 'Boot-Prozess', question: 'Boot-Kette: _______ ‚Üí Bootloader ‚Üí _______ (+initramfs) ‚Üí _______ (PID 1).', correct: [
                ['Firmware','BIOS','UEFI','Firmware/BIOS/UEFI'],
                ['Kernel','Linux-Kernel','Kernel+initramfs','Linux-Kernel und initramfs'],
                ['systemd','Init-System','SysVinit','PID 1']
            ], placeholder: ['(1) Firmware', '(2) Kernel', '(3) Init-System'], explanation: 'Firmware/BIOS/UEFI ‚Üí Bootloader (z. B. GRUB) ‚Üí Kernel (+initramfs) ‚Üí systemd.' },

            // 14‚Äì19) SSH Fakten (Bild 6)
            { type: 'RF', id: 14, category: 'ssh', categoryName: 'SSH & Sicherheit', question: '(R/F) Der Standardport f√ºr SSH ist 5432.', options: ['Richtig', 'Falsch'], correct: 1, explanation: 'SSH ‚Üí Port 22. 5432 ist PostgreSQL.' },
            { type: 'RF', id: 15, category: 'ssh', categoryName: 'SSH & Sicherheit', question: '(R/F) Die Datei authorized_keys auf dem Server verwaltet die zugelassenen Public Keys der Benutzer.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Genau daf√ºr ist sie da.' },
            { type: 'RF', id: 16, category: 'ssh', categoryName: 'SSH & Sicherheit', question: '(R/F) SSH-Keys bieten sicherheitstechnisch keine Vorteile gegen√ºber Passw√∂rtern.', options: ['Richtig', 'Falsch'], correct: 1, explanation: 'Falsch: deutlich sicherer (Phishing-resistenter, kryptographisch st√§rker).' },
            { type: 'RF', id: 17, category: 'ssh', categoryName: 'SSH & Sicherheit', question: '(R/F) Unbekannte Schl√ºssel werden bei Login automatisch zu authorized_keys hinzugef√ºgt.', options: ['Richtig', 'Falsch'], correct: 1, explanation: 'Nein, Keys m√ºssen manuell/hinterlegt werden.' },
            { type: 'RF', id: 18, category: 'ssh', categoryName: 'SSH & Sicherheit', question: '(R/F) √úber SSH √ºbertragene Daten sind grunds√§tzlich verschl√ºsselt.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Ja, Transport ist verschl√ºsselt.' },
            { type: 'RF', id: 19, category: 'ssh', categoryName: 'SSH & Sicherheit', question: '(R/F) Der private SSH-Schl√ºssel (z. B. id_rsa oder id_ed25519) darf nie weitergegeben werden.', options: ['Richtig', 'Falsch'], correct: 0, explanation: 'Private Keys bleiben privat.' },

            // 20) Dateirechte (Bild 7)
            { type: 'MC', id: 20, category: 'perm', categoryName: 'Dateirechte', question: 'Welche Zuordnungen Oktal ‚Üí Symbol sind korrekt?', options: [
                '711 ‚Üí rwx--x--x',
                '644 ‚Üí rw-r--r--',
                '755 ‚Üí rwxr-xr-x',
                '777 ‚Üí rwxrwxrwx',
                '700 ‚Üí rwx------'
            ], correct: [0,1,2,3,4], explanation: 'Alle f√ºnf Paare sind korrekt.' },

            // 21) systemctl-Symlink (Bild 8)
            { type: 'SC', id: 21, category: 'boot', categoryName: 'Boot-Prozess', question: 'Welcher Befehl ist heute oft als Symlink auf systemctl implementiert?', options: [
                'chmod','mount','reboot','ifconfig'
            ], correct: 2, explanation: 'Viele Klassiker (reboot/poweroff/halt) verweisen auf systemctl.' },

            // 22) GRUB Aufgabe (Bild 9)
            { type: 'SC', id: 22, category: 'boot', categoryName: 'Boot-Prozess', question: 'Prim√§re Aufgabe von GRUB im Linux-Bootprozess?', options: [
                'POST der Hardware ausf√ºhren.',
                'Root-Partition permanent read-write remounten.',
                'Kernel (und initramfs) von Datentr√§ger laden und an ihn √ºbergeben.',
                'Alle Systemdienste (PID 1) starten und verwalten.'
            ], correct: 2, explanation: 'GRUB l√§dt Kernel+initramfs in den Speicher und √ºbergibt.' },

            // 23) initramfs Zweck (Bild 10)
            { type: 'SC', id: 23, category: 'boot', categoryName: 'Boot-Prozess', question: 'Hauptzweck von initramfs?', options: [
                'Nur bei verschl√ºsselten Datentr√§gern ben√∂tigt.',
                'Enth√§lt komplettes Userspace-System ‚Äì Root-FS wird nicht mehr ben√∂tigt.',
                'Bringt fr√ºhe Treiber/Logik mit, findet & mountet das Root-Dateisystem und startet den eigentlichen Init-Prozess.',
                'Ersetzt den Bootloader und l√§dt direkt die Firmware.'
            ], correct: 2, explanation: 'initramfs = tempor√§res Root mit Treibern, mountet Root-FS und startet Init.' }
        ];

        let currentQuestionIndex = 0;
        let userAnswers = {};
        let filteredQuestions = [];
        let currentCategory = 'all';

        function initializeQuiz(category) {
            currentCategory = category;
            if (category === 'all') {
                filteredQuestions = questionsData.slice();
            } else {
                filteredQuestions = questionsData.filter(q => q.category === category);
            }
            if (currentQuestionIndex >= filteredQuestions.length) currentQuestionIndex = 0;

            if (filteredQuestions.length === 0) {
                document.getElementById('quizContainer').innerHTML = '<p style="text-align: center; margin-top: 50px; font-size: 1.2em;">Keine Fragen in dieser Kategorie.</p>';
                document.getElementById('prevBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('finishBtn').style.display = 'none';
                document.getElementById('checkAnswerBtn').style.display = 'none';
                updateProgress();
                return;
            }
            renderQuestion();
            updateProgress();
            updateNavigationButtons();
        }

        function updateProgress() {
            const totalQuestions = filteredQuestions.length;
            const inScopeIds = new Set(filteredQuestions.map(q => String(q.id)));
            const answersInScope = Object.keys(userAnswers)
                .filter(id => inScopeIds.has(String(id)) && userAnswers[id])
                .map(id => userAnswers[id]);

            const answeredQuestions = answersInScope.filter(a => a.isAnswered).length;
            const correctCount = answersInScope.filter(a => a.isCorrect).length;
            const wrongCount = answersInScope.filter(a => a.isAnswered && !a.isCorrect).length;

            const successRate = answeredQuestions > 0 ? ((correctCount / answeredQuestions) * 100).toFixed(0) : 0;
            const progress = (answeredQuestions / (totalQuestions || 1)) * 100;

            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressFill').textContent = `${progress.toFixed(0)}%`;
            document.getElementById('progressText').textContent = `${answeredQuestions}/${totalQuestions}`;
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
            document.getElementById('successRate').textContent = `${successRate}%`;

            if (answeredQuestions === totalQuestions && totalQuestions > 0) {
                document.getElementById('finishBtn').style.display = 'inline-block';
            } else {
                document.getElementById('finishBtn').style.display = 'none';
            }
        }

        function renderQuestion() {
            const questionContainer = document.getElementById('quizContainer');
            if (filteredQuestions.length === 0) return;

            const question = filteredQuestions[currentQuestionIndex];
            const userAnswerObj = userAnswers[question.id];
            const isAnswered = !!(userAnswerObj && userAnswerObj.isAnswered);
            const currentAnswer = userAnswerObj ? userAnswerObj.selection : null;

            let optionsHtml = '';

            if (question.type === 'SC' || question.type === 'MC' || question.type === 'RF') {
                optionsHtml = question.options.map((option, index) => {
                    const isSelected = Array.isArray(currentAnswer) ? currentAnswer.includes(index) : currentAnswer === index;
                    const isCorrect = isAnswered && (Array.isArray(question.correct) ? question.correct.includes(index) : question.correct === index);
                    const isWrongSelection = isSelected && isAnswered && !isCorrect;
                    const optionClass = isSelected ? 'selected' : '';
                    const resultClass = isAnswered ? (isCorrect ? 'correct' : (isWrongSelection ? 'wrong' : '')) : '';
                    const letter = String.fromCharCode(65 + index);
                    return `
                        <div class="option ${optionClass} ${resultClass}" data-index="${index}">
                            <div class="option-letter">${letter}</div>
                            <span>${option}</span>
                            ${question.type === 'MC' && !isAnswered ? `<input type="checkbox" class="option-checkbox" ${isSelected ? 'checked' : ''} />` : ''}
                            ${isAnswered && question.type === 'MC' && isCorrect ? '‚úÖ' : ''}
                            ${isAnswered && question.type === 'MC' && isWrongSelection ? '‚ùå' : ''}
                        </div>
                    `;
                }).join('');
            } else if (question.type === 'FTB') {
                optionsHtml = '<div class="fill-in-the-blank-container">';
                const numBlanks = question.correct.length;
                for (let i = 0; i < numBlanks; i++) {
                    const value = currentAnswer && currentAnswer[i] !== undefined ? currentAnswer[i] : '';
                    const placeholder = question.placeholder ? question.placeholder[i] : `L√ºcke ${i + 1}`;
                    let inputClass = 'fill-in-the-blank-input';
                    if (isAnswered) {
                        const isBlankCorrect = userAnswerObj.correctBlanks[i];
                        inputClass += isBlankCorrect ? ' correct-answer' : ' wrong-answer';
                    }
                    optionsHtml += `
                        <div class="fill-in-the-blank-wrapper">
                            <label for="ftb-${i}" class="fill-in-the-blank-label">${placeholder}:</label>
                            <input type="text" id="ftb-${i}" data-index="${i}" class="${inputClass}" value="${value.replace(/"/g,'&quot;')}" ${isAnswered ? 'disabled' : ''}>
                        </div>
                    `;
                }
                optionsHtml += '</div>';
            }

            questionContainer.innerHTML = `
                <div class="question-card fade-in" id="q-${question.id}">
                    <div class="question-header">
                        <div class="question-number">Frage ${currentQuestionIndex + 1} von ${filteredQuestions.length}</div>
                        <div class="category-tag">${question.categoryName} (${question.type})</div>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="options ${question.type === 'MC' ? 'multiple-choice' : ''}">${optionsHtml}</div>
                    <div class="answer-section ${isAnswered ? 'show' : 'hide'}" id="answer-q-${question.id}">
                        <div class="answer-header">L√∂sung:</div>
                        <div class="answer-text">
                            ${isAnswered ? getAnswerExplanation(question, userAnswerObj) : ''}
                            ${question.explanation ? `<p style="margin-top: 10px; font-style: italic;">Erkl√§rung: ${question.explanation}</p>` : ''}
                        </div>
                    </div>
                </div>
            `;

            if (question.type === 'SC' || question.type === 'MC' || question.type === 'RF') {
                document.querySelectorAll('.option').forEach(optionElement => {
                    if (!isAnswered) {
                        optionElement.addEventListener('click', () => handleOptionClick(question, optionElement));
                    }
                });
            }

            updateNavigationButtons();
            const checkBtn = document.getElementById('checkAnswerBtn');
            checkBtn.onclick = () => checkAnswer(question);
            checkBtn.style.display = isAnswered ? 'none' : 'inline-block';
        }

        function getAnswerExplanation(question, userAnswer) {
            if (!userAnswer) return '';
            if (question.type === 'SC' || question.type === 'MC' || question.type === 'RF') {
                const correctOptions = Array.isArray(question.correct) ? question.correct : [question.correct];
                const correctLetters = correctOptions.map(i => String.fromCharCode(65 + i)).join(', ');
                const userLetters = Array.isArray(userAnswer.selection)
                    ? userAnswer.selection.map(i => String.fromCharCode(65 + i)).join(', ')
                    : (userAnswer.selection !== null && userAnswer.selection !== undefined ? String.fromCharCode(65 + userAnswer.selection) : 'N/A');

                const status = userAnswer.isCorrect
                    ? '<span style="color: #28a745; font-weight: bold;">RICHTIG!</span>'
                    : '<span style="color: #dc3545; font-weight: bold;">FALSCH.</span>';

                return `
                    <p>Status: ${status}</p>
                    <p>Deine Auswahl: ${userAnswer.selection === null ? 'Keine Auswahl' : userLetters}</p>
                    ${question.type !== 'RF' ? `<p>Korrekte Option(en): ${correctLetters} (${correctOptions.map(i => question.options[i]).join('; ')})</p>` : ''}
                `;
            } else if (question.type === 'FTB') {
                let html = userAnswer.isCorrect
                    ? '<p style="color: #28a745; font-weight: bold;">RICHTIG!</p>'
                    : '<p style="color: #dc3545; font-weight: bold;">FALSCH.</p>';
                html += '<table><thead><tr><th>L√ºcke</th><th>Deine Antwort</th><th>Korrekt</th></tr></thead><tbody>';
                for (let i = 0; i < question.correct.length; i++) {
                    const userVal = (userAnswer.selection[i] || '');
                    const corr = Array.isArray(question.correct[i]) ? question.correct[i].join(' / ') : question.correct[i];
                    const statusIcon = userAnswer.correctBlanks[i] ? '‚úÖ' : '‚ùå';
                    const placeholderText = question.placeholder ? question.placeholder[i] : `L√ºcke ${i+1}`;
                    html += `<tr><td>${placeholderText}</td><td>${statusIcon} ${userVal}</td><td>${corr}</td></tr>`;
                }
                html += '</tbody></table>';
                return html;
            }
            return '';
        }

        function handleOptionClick(question, optionElement) {
            const index = parseInt(optionElement.getAttribute('data-index'));
            const options = document.querySelectorAll('.option');
            let currentSelection = (userAnswers[question.id] && userAnswers[question.id].selection)
                ? (Array.isArray(userAnswers[question.id].selection) ? [...userAnswers[question.id].selection] : userAnswers[question.id].selection)
                : (question.type === 'MC' ? [] : null);

            if (question.type === 'SC' || question.type === 'RF') {
                options.forEach(opt => opt.classList.remove('selected'));
                currentSelection = index;
                optionElement.classList.add('selected');
            } else if (question.type === 'MC') {
                if (!Array.isArray(currentSelection)) currentSelection = [];
                if (optionElement.classList.contains('selected')) {
                    optionElement.classList.remove('selected');
                    const idxToRemove = currentSelection.indexOf(index);
                    if (idxToRemove > -1) currentSelection.splice(idxToRemove, 1);
                } else {
                    optionElement.classList.add('selected');
                    if (!currentSelection.includes(index)) currentSelection.push(index);
                }
            }

            userAnswers[question.id] = { selection: currentSelection, isAnswered: false, isCorrect: false };
            updateProgress();
        }

        function checkAnswer(question) {
            if (userAnswers[question.id] && userAnswers[question.id].isAnswered) return;

            let isCorrect = false;
            let currentSelection = null;
            let correctBlanks = [];

            if (question.type === 'SC' || question.type === 'MC' || question.type === 'RF') {
                const selectedOptions = Array.from(document.querySelectorAll('.option.selected')).map(el => parseInt(el.getAttribute('data-index')));
                currentSelection = (question.type === 'SC' || question.type === 'RF')
                    ? (selectedOptions.length > 0 ? selectedOptions[0] : null)
                    : selectedOptions;

                if (question.type === 'SC' || question.type === 'RF') {
                    isCorrect = currentSelection === question.correct;
                } else { // MC
                    const correctAnswers = question.correct;
                    isCorrect = selectedOptions.length === correctAnswers.length &&
                                selectedOptions.every(val => correctAnswers.includes(val));
                }
            } else if (question.type === 'FTB') {
                const inputs = Array.from(document.querySelectorAll('.fill-in-the-blank-input'));
                currentSelection = inputs.map(input => input.value.trim());
                let allBlanksCorrect = true;
                correctBlanks = currentSelection.map((userAns, index) => {
                    const correctAnswers = Array.isArray(question.correct[index]) ? question.correct[index] : [question.correct[index]];
                    const match = correctAnswers.some(correctAnswer => userAns.toLowerCase() === String(correctAnswer).toLowerCase());
                    if (!match) allBlanksCorrect = false;
                    return match;
                });
                isCorrect = allBlanksCorrect;
            }

            userAnswers[question.id] = {
                selection: currentSelection,
                isAnswered: true,
                isCorrect: isCorrect,
                correctBlanks: correctBlanks
            };

            renderQuestion();
            updateProgress();
        }

        function updateNavigationButtons() {
            const total = filteredQuestions.length;

            document.getElementById('prevBtn').style.display = currentQuestionIndex > 0 ? 'inline-block' : 'none';
            document.getElementById('nextBtn').style.display = currentQuestionIndex < total - 1 ? 'inline-block' : 'none';

            if (currentQuestionIndex === total - 1 && total > 0) {
                document.getElementById('finishBtn').style.display = 'inline-block';
                document.getElementById('nextBtn').style.display = 'none';
            } else {
                document.getElementById('finishBtn').style.display = 'none';
            }
        }

        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentQuestionIndex < filteredQuestions.length - 1) {
                currentQuestionIndex++;
                renderQuestion();
            }
        });

        document.getElementById('finishBtn').addEventListener('click', () => {
            showResults();
        });

        function showResults() {
            const totalQuestions = filteredQuestions.length;
            const inScopeIds = new Set(filteredQuestions.map(q => String(q.id)));
            const answersInScope = Object.keys(userAnswers)
                .filter(id => inScopeIds.has(String(id)) && userAnswers[id]);

            const correctCount = answersInScope.filter(id => userAnswers[id].isCorrect).length;
            const answeredCount = answersInScope.filter(id => userAnswers[id].isAnswered).length;

            const score = (correctCount / (totalQuestions || 1)) * 100;
            const passed = score >= 50;

            document.querySelector('.quiz-content').innerHTML = `
                <div class="result-summary fade-in">
                    <h2>${passed ? 'Gl√ºckwunsch! üéâ' : 'Weiter √ºben‚Ä¶ üòÖ'}</h2>
                    <p>Du hast die Kategorie <strong>"${document.querySelector('.category-btn.active')?.textContent || 'Alle Fragen'}"</strong> abgeschlossen.</p>
                    <div class="result-score">${correctCount}/${totalQuestions}</div>
                    <p>Erfolgsrate: <strong>${score.toFixed(0)}%</strong></p>

                    <div class="result-details">
                        <div class="result-detail">
                            <div class="stat-label">Gesamtzahl Fragen</div>
                            <div class="result-detail-value">${totalQuestions}</div>
                        </div>
                        <div class="result-detail">
                            <div class="stat-label">Beantwortet</div>
                            <div class="result-detail-value">${answeredCount}</div>
                        </div>
                        <div class="result-detail">
                            <div class="stat-label">Richtig</div>
                            <div class="result-detail-value" style="color: #28a745;">${correctCount}</div>
                        </div>
                        <div class="result-detail">
                            <div class="stat-label">Falsch</div>
                            <div class="result-detail-value" style="color: #dc3545;">${answeredCount - correctCount}</div>
                        </div>
                    </div>

                    <div class="button-group" style="margin-top: 40px;">
                        <button class="btn btn-primary" onclick="window.location.reload();">Neues Quiz starten</button>
                        <button class="btn btn-secondary" onclick="reviewAnswers();">Antworten einsehen</button>
                    </div>
                </div>
            `;
        }

        function reviewAnswers() {
            currentQuestionIndex = 0;
            initializeQuiz(currentCategory);
            document.getElementById('checkAnswerBtn').style.display = 'none';
            document.getElementById('finishBtn').style.display = 'none';
        }

        function setupCategories() {
            const categoriesCount = questionsData.reduce((acc, q) => {
                acc[q.category] = (acc[q.category] || 0) + 1;
                return acc;
            }, {});

            const categorySelector = document.getElementById('categorySelector');
            let html = `<button class="category-btn active" data-category="all">Alle Fragen (${questionsData.length})</button>`;

            const nameBase = {
                'info': 'Informationssysteme',
                'ssh': 'SSH & Sicherheit',
                'os': 'OS-Grundlagen',
                'boot': 'Boot-Prozess/systemd',
                'perm': 'Dateirechte'
            };

            const orderedCategories = ['info','ssh','os','boot','perm'];

            orderedCategories.forEach(cat => {
                if (categoriesCount[cat]) {
                    const name = `${nameBase[cat] || cat} (${categoriesCount[cat]})`;
                    html += `<button class="category-btn" data-category="${cat}">${name}</button>`;
                }
            });

            categorySelector.innerHTML = html;

            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentQuestionIndex = 0;
                    userAnswers = {}; // Antworten zur√ºcksetzen beim Kategoriewechsel
                    initializeQuiz(e.target.getAttribute('data-category'));
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            setupCategories();
            initializeQuiz('all');
        });
    </script>
</body>
</html>
